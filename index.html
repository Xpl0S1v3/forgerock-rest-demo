<!DOCTYPE html>
<!--
/*
 * The contents of this file are subject to the terms of the Common Development and
 * Distribution License (the License). You may not use this file except in compliance with the
 * License.
 *
 * You can obtain a copy of the License at legal/CDDLv1.0.txt. See the License for the
 * specific language governing permission and limitations under the License.
 *
 * When distributing Covered Software, include this CDDL Header Notice in each file and include
 * the License file at legal/CDDLv1.0.txt. If applicable, add the following below the CDDL
 * Header, with the fields enclosed by brackets [] replaced by your own identifying
 * information: "Portions Copyrighted [year] [name of copyright owner]".
 *
 * Copyright Â© 2012-2013 ForgeRock AS. All rights reserved.
 */
-->
<html>
<head>
    <title>ForgeRock Common REST Demo</title>
    <meta charset="utf-8" />
    <link rel="shortcut icon" href="images/favicon.ico" />
    <link rel="stylesheet" href="http://code.jquery.com/ui/1.9.2/themes/base/jquery-ui.css" />
    <script type="text/javascript" src="http://code.jquery.com/jquery-1.8.3.js"></script>
    <script type="text/javascript" src="http://code.jquery.com/ui/1.9.2/jquery-ui.js"></script>
    <script type="text/javascript" src="common.js"></script>
    <script type="text/javascript" src="util.js"></script>
    <script type="text/javascript">
        $(function() {
            $( "#tabs" ).tabs({
                beforeActivate: function(event, ui) {
                    empty(document.getElementById("log"));
                }
            });
            $( "button" ).button();
            $( "checkboxes" ).buttonset();
            $( ".field" ).menu();
            $( "select" ).menu();
            $( "form" ).sortable().width("auto");
            $( "#log").dialog({
                autoOpen: false,
                width: "auto"
            });
            $( ".logger").click(function() {
                $("#log").dialog("open");
            });
        });
    </script>
    <style type="text/css">
        body {
            font-family: Verdana,Arial,sans-serif;
        }
        #tabs {
            font-size: medium;
            overflow: auto;
            width: 100%;
        }
        #about, #action, #prerequisites {
            max-width: 800px;
        }
        button {
            float: right;
        }
        dt {
            float: left;
            clear: left;
            font-weight: bold;
            text-align: right;
            width: 100px;
        }
        dt:after {
            content: ":";
        }
        dd {
            margin: 0 0 0 110px;
            padding: 0 0 0.5em 0;
        }
        form {
            font-size: small;
            float: left;
            border: 1px dashed #d3d3d3;
            margin-left: 10px;
            margin-right: 10px;
            margin-bottom: 10px;
            padding: 10px;
        }
        #log {
            font-size: small;
            margin: 10px;
        }
        table {
            border: 1px solid black;
            border-collapse: collapse;
            font-size: small;
        }
        th, td {
            border: 1px solid black;
            margin: 5px;
            padding: 5px;
            text-align: left;
            vertical-align: top;
        }
        th {
            background-color: #808080;
            color: white;
        }
    </style>
</head>
<body>
<a href="http://commons.forgerock.org/forgerock-rest/json-resource-servlet/"><img
        style="float: right;"
        src="http://forgerock.org/images/ForgeRock-Community-grey-295x50.png"
/></a>
<h1>ForgeRock Common REST Demo</h1>

<div id="tabs">

    <ul>
        <li><a href="#prerequisites">Before You Start</a></li>
        <li><a href="#create">Create</a></li>
        <li><a href="#read">Read</a></li>
        <li><a href="#update">Update</a></li>
        <li><a href="#delete">Delete</a></li>
        <li><a href="#patch">Patch</a></li>
        <li><a href="#action">Action</a></li>
        <li><a href="#query">Query</a></li>
        <li><a href="#about">About</a></li>
    </ul>

    <div id="prerequisites">
        <p>
            This demo uses the REST API exposed by the
            <a href="http://commons.forgerock.org/forgerock-rest/json-resource-servlet/"
                    >JSON Resource Servlet</a>.
        </p>

        <ol>
            <li>
                Download and deploy the JSON Resource Servlet .war under
                <code>http://<i>host</i>:<i>port</i>/json</code>.
            </li>

            <li>
                Deploy this demo as static pages alongside the JSON Resource
                Servlet.
            </li>
        </ol>

        <p>
            Interacting with the JSON Resource Servlet in JavaScript is
            simple: see <a href="common.js" target="_blank">common.js</a>.
            Nearly all of the JavaScript in this demo is for interacting with
            web forms, and handling page layout.
        </p>

        <p>
            This demo provides sample <a href="Users.json" target="_blank">users</a>
            and <a href="Groups.json" target="_blank">groups</a> in JSON format.
        </p>

        <p>
            Provision users and groups with the buttons below. When you click one
            of the buttons, the latest response from the JSON Resource Servlet is
            shown below the buttons.
        </p>

        <button type="button" class="logger" style="float: left;"
                onclick="provisionUsers('log'); return false;"
                >Provision Users</button>
        <button type="button" class="logger" style="float: left;"
                onclick="provisionGroups('log'); return false;"
                >Provision Groups</button>
    </div>

    <div id="create">
        <form id="create-user" action="#">
            <h3>Create User</h3>
            <label for="create-mail">* Email</label>
            <input id="create-mail" class="field" type="email" required="required" />

            <label for="create-firstname">* First Name</label>
            <input id="create-firstname" class="field" type="text" required="required" />

            <label for="create-lastname">* Last Name</label>
            <input id="create-lastname" class="field" type="text" required="required" />

            <label for="create-userpassword">Password</label>
            <input id="create-userpassword" class="field" type="password" />

            <label for="create-phone">Phone</label>
            <input id="create-phone" class="field" type="tel" />

            <label for="create-fax">Fax</label>
            <input id="create-fax" class="field" type="tel" />

            <label for="create-room">Room Number</label>
            <input id="create-room" class="field" type="number" />

            <label for="create-location">Location</label>
            <select id="create-location" class="field">
                <option>Select Location</option>
                <option value="Cupertino">Cupertino</option>
                <option value="Paris">Paris</option>
                <option value="Santa Clara">Santa Clara</option>
                <option value="Sunnyvale">Sunnyvale</option>
            </select>

            <label for="create-homeDirectory">Home Directory</label>
            <input id="create-homeDirectory" class="field" type="text" />

            <label for="create-uidNumber">UID Number</label>
            <input id="create-uidNumber" class="field" type="number" />

            <label for="create-gidNumber">GID Number</label>
            <input id="create-gidNumber" class="field" type="number" />

            <button type="button" class="logger"
                    onclick="createUser(this.form, 'create-', 'log'); return false;"
                    >Create</button>
        </form>

        <form id="create-group">
            <h3>Create Group</h3>
            <label for="create-name">* Name</label>
            <input id="create-name" class="field" type="text" required="required" />

            <label for="create-description">Description</label>
            <input id="create-description" class="field" type="text" />

            <label for="create-users">Members</label>
            <select id="create-users" class="field" multiple="multiple"
                    onfocus="populateUserList('create-users')">
                <option>Select Members</option>
            </select>

            <button type="button" class="logger"
                    onclick="createGroup(this.form, 'create-', 'log'); return false;"
                    >Create</button>
        </form>
    </div>

    <div id="read">
        <form id="read-user">
            <h3>Read User</h3>
            <select id="read-select-user" class="field"
                    onfocus="populateUserList('read-select-user')">
                <option>Select User</option>
            </select>

            <div class="checkboxes">
                <label>Retrieve:</label>
                <input id="read-mail" type="checkbox" checked="checked" class="checkbox" />
                <label for="read-mail">Email</label>

                <input id="read-fullname" type="checkbox" checked="checked" class="checkbox" />
                <label for="read-fullname">Name</label>

                <input id="read-phone" type="checkbox" class="checkbox" />
                <label for="read-phone">Phone</label>

                <input id="read-all" type="checkbox"  class="checkbox" />
                <label for="read-all">Everything</label>
            </div>

            <button type="button" class="logger"
                    onclick="writeUserTable(this.form, 'read-', 'select-user', 'log'); return false;"
                    >Read</button>
        </form>

        <form id="read-group">
            <h3>Read Group</h3>
            <select id="read-select-group" class="field"
                    onfocus="populateGroupList('read-select-group')">
                <option>Select Group</option>
            </select>

            <button type="button" class="logger"
                    onclick="writeGroupTable(this.form, 'read-', 'select-group', 'log'); return false;"
                    >Read</button>
        </form>
    </div>

    <div id="update">
        <form id="update-user">
            <h3>Update User</h3>
            <label for="update-select-user">User to update</label>
            <select id="update-select-user" class="field"
                    onfocus="populateUserList('update-select-user')">
                <option>Select User</option>
            </select>

            <button type="button"
                    onclick="selectUserFromList(this.form, 'update-', 'select-user'); return false;"
                    >Load</button>

            <br style="clear: both;"/>

            <input id="update-userId" type="hidden" />
            <input id="update-userVersion" type="hidden" />

            <label for="update-mail">Email</label>
            <input id="update-mail" class="field" type="email" readonly="readonly" />

            <label for="update-firstname">First Name</label>
            <input id="update-firstname" class="field" type="text" />

            <label for="update-lastname">Last Name</label>
            <input id="update-lastname" class="field" type="text" />

            <label for="update-userpassword">Password</label>
            <input id="update-userpassword" class="field" type="password" />

            <label for="update-phone">Phone</label>
            <input id="update-phone" class="field" type="tel" />

            <label for="update-fax">Fax</label>
            <input id="update-fax" class="field" type="tel" />

            <label for="update-room">Room Number</label>
            <input id="update-room" class="field" type="number" />

            <label for="update-location">Location</label>
            <select id="update-location" class="field">
                <option>Select Location</option>
                <option value="Cupertino">Cupertino</option>
                <option value="Paris">Paris</option>
                <option value="Santa Clara">Santa Clara</option>
                <option value="Sunnyvale">Sunnyvale</option>
            </select>

            <label for="update-homeDirectory">Home Directory</label>
            <input id="update-homeDirectory" class="field" type="text" />

            <label for="update-uidNumber">UID Number</label>
            <input id="update-uidNumber" class="field" type="number" />

            <label for="update-gidNumber">GID Number</label>
            <input id="update-gidNumber" class="field" type="number" />

            <button type="button" class="logger"
                    onclick="updateUser(this.form, 'update-', 'log'); return false;
                    ">Update</button>
        </form>

        <form id="update-group">
            <h3>Update Group</h3>
            <label for="update-select-group">Group to update</label>
            <select id="update-select-group" class="field"
                    onfocus="populateGroupList('update-select-group')">
                <option>Select Group</option>
            </select>

            <button type="button"
                    onclick="selectGroupFromList(this.form, 'update-', 'select-group', 'members'); return false;"
                    >Load</button>

            <br style="clear: both;"/>

            <input id="update-groupId" type="hidden" />
            <input id="update-groupVersion" class="field" type="hidden" />

            <label for="update-name">Name</label>
            <input id="update-name" class="field" type="text" readonly="readonly" />

            <label for="update-description">Description</label>
            <input id="update-description" class="field" type="text" />

            <label for="update-members">Members</label>
            <select id="update-members" class="field" multiple="multiple"></select>

            <button type="button" class="logger"
                    onclick="updateGroup(this.form, 'update-', 'log'); return false;
                    ">Update</button>
        </form>
    </div>

    <div id="delete">
        <form id="delete-user-by-uid" action="#">
            <h3>Delete User By ID</h3>
            <label for="delete-uid"></label>
            <input id="delete-uid" class="field" type="text" value=""/>
            <button type="button" class="logger" style="float: left;"
                    onclick="listUsersByUid('log'); return false;"
                    >List User IDs</button>
            <button type="button" class="logger"
                    onclick="deleteUser(this.form, 'delete-', 'log'); return false;"
                    >Delete</button>
        </form>

        <form id="delete-user-from-list" action="#">
            <h3>Delete User From List</h3>
            <select id="delete-select-user" class="field"
                    onfocus="populateUserList('delete-select-user')">
                <option>Select User</option>
            </select>
            <button type="button" class="logger"
                    onclick="deleteUserFromList('delete-select-user', 'log'); return false;"
                    >Delete</button>
        </form>

        <form id="delete-group-by-name" action="#">
            <h3>Delete Group By Name</h3>
            <label for="delete-name"></label>
            <input id="delete-name" class="field" type="text" value="" />
            <button type="button" class="logger" style="float: left;"
                    onclick="listGroupsByName('log'); return false;"
                    >List Groups</button>
            <button type="button" class="logger"
                    onclick="deleteGroup(this.form, 'delete-', 'log'); return false;"
                    >Delete</button>
        </form>

        <form id="delete-group-from-list" action="#">
            <h3>Delete Group From List</h3>
            <select id="delete-select-group" class="field"
                    onfocus="populateGroupList('delete-select-group')">
                <option>Select Group</option>
            </select>
            <button type="button" class="logger"
                    onclick="deleteGroupFromList('delete-select-group', 'log'); return false;"
                    >Delete</button>
        </form>
    </div>

    <div id="patch">
        <p>
            TODO: Demonstrate when patch is finished. See
            <a href="https://bugster.forgerock.org/jira/browse/CREST-3">CREST-3</a>.
        </p>
    </div>

    <div id="action">
        <h3>Default Actions</h3>
        <p>
            The default JSON Resource Servlet implements only the actions
            corresponding to the other six basic verbs: create, read, update,
            delete, patch, and query.
        </p>

        <p>
            In other words, you can call those verbs as actions with an HTTP POST.
            For example, to create a user with an ID assigned by the resource store,
            POST the JSON representation of the user to
            <code>/users?_action=create</code>.
        </p>

        <h3>Custom Actions</h3>
        <p>
            Other resource stores can define additional actions. For example,
            if the resource store supports tasks, it might also support a
            cancel action, <code>/tasks/1?_action=cancel</code>.
        </p>
    </div>

    <div id="query">
        <form id="query-users">
            <h3>Query Users</h3>
            <div class="checkboxes">
                <label>Retrieve:</label>
                <input id="query-mail" type="checkbox" checked="checked" class="checkbox" />
                <label for="query-mail">Email</label>

                <input id="query-fullname" type="checkbox" checked="checked" class="checkbox" />
                <label for="query-fullname">Name</label>

                <input id="query-phone" type="checkbox" class="checkbox" />
                <label for="query-phone">Phone</label>

                <input id="query-all" type="checkbox" class="checkbox" />
                <label for="query-all">Everything</label>
            </div>

            <button type="button" class="logger"
                    onclick="writeUsersTable(this.form, 'query-', 'log'); return false;"
                    >Query Users</button>
        </form>

        <form id="query-groups">
            <h3>Query Groups</h3>
            <div class="checkboxes">
                <label>Retrieve:</label>
                <input id="query-name" type="checkbox" checked="checked" class="checkbox" />
                <label for="query-name">Name</label>

                <input id="query-members" type="checkbox" checked="checked" class="checkbox" />
                <label for="query-members">Members</label>

                <input id="query-description" type="checkbox" class="checkbox" />
                <label for="query-description">Description</label>
            </div>

            <button type="button" class="logger"
                    onclick="writeGroupsTable(this.form, 'query-', 'log'); return false;"
                    >Query Groups</button>
        </form>

        <pre style="clear: both;">
TODO:
// _filter=FILTER, where the filter is TBD
// _sortKeys=[+-]FIELD,..., where + is encoded as %2B, and is also the default
// _pagedResultsCookie=STRING
// _pageSize=INTEGER
// _queryId=ID to trigger a stored query, also takes arg1=value1 to argN=valueN: Not for the default backend

http://localhost:8080/json/users?_filter=uid%20co%20%22jensen%22&amp;_sortKeys=fullname&amp;_pageSize=2&amp;_prettyPrint=true
http://localhost:8080/json/groups?_filter=true&amp;_sortKeys=name&amp;_prettyPrint=true
        </pre>
    </div>

    <div id="about">
        <h3>Verbs</h3>
        <p>
            The ForgeRock common REST API defines seven verbs.
        </p>

        <dl>
            <dt>Create</dt>
            <dd>Add a resource that does not yet exist</dd>

            <dt>Read</dt>
            <dd>Retrieve a single resource</dd>

            <dt>Update</dt>
            <dd>Replace an existing resource</dd>

            <dt>Delete</dt>
            <dd>Remove an existing resource</dd>

            <dt>Patch</dt>
            <dd>Modify part of an existing resource</dd>

            <dt>Action</dt>
            <dd>Perform a predefined action</dd>

            <dt>Query</dt>
            <dd>List a set of resources</dd>
        </dl>

        <p>
            A resource store can use the ForgeRock
            <a href="http://commons.forgerock.org/forgerock-rest/">REST
                libraries</a>
            to expose a common CRUDPAQ API.
        </p>

        <h3>Endpoints</h3>
        <p>
            A resource store defines collection endpoints for resources that it
            serves. The default
            <a href="http://commons.forgerock.org/forgerock-rest/json-resource-servlet/"
                    >JSON Resource Servlet</a> defines two collection endpoints,
            <code>/users</code> and <code>/groups</code>.
        </p>

        <h3>Extensions</h3>

        <dl>
            <dt>Action</dt>
            <dd>
                <p>
                    By default, the only actions defined are those corresponding
                    to the other six basic verbs: create, read, update, delete,
                    patch, and query.
                </p>

                <p>
                    A resource store might define additional actions that it allows.
                    For example, <code>/tasks/1?_action=cancel</code>.
                </p>
            </dd>

            <dt>Query</dt>
            <dd>
                <p>
                    A resource store might define additional stored queries that
                    can be called by their IDs. For example,
                    <code>/groups?_queryId=hasDeletedMembers</code>.
                </p>
            </dd>
        </dl>
    </div>
</div>

<div id="log" title="Result"></div>
</body>
</html>