<!DOCTYPE html>
<html>
<head>
    <title>Read</title>
    <script type="text/javascript" src="common.js"></script>
    <script type="text/javascript">

function populateUserList() {
    var list = document.getElementById("select-user");

    // Sort users by fullname, which is an array.
    var options = queryObjects("/users", [])
            .sort(function(a,b){ return a.fullname[0].toString()
                    .localeCompare(b.fullname[0].toString()) });

    if (options.length > 0) { empty(list); }

    for (var i = 0; i < options.length; i++) {
        var element = document.createElement("option");
        element.textContent = options[i].fullname[0];
        element.value = options[i].uid;
        list.appendChild(element);
    }
}

function readUser(form) {
    var list = document.getElementById("select-user");
    var id = list.options[list.selectedIndex].value;

    var queryString = "";
    if (form.all.checked) {
        // Leave query string empty.
    } else {
        var fields = new Array();
        if (form.mail.checked) { fields.push("mail"); }
        if (form.fullname.checked) { fields.push("fullname"); }
        if (form.phone.checked) { fields.push("phone"); }

        if (fields.length > 0) {
            queryString = "?_fields=" + fields[0];
            for (var i = 1; i < fields.length; i++) {
                queryString = queryString + "," + fields[i];
            }
        }
    }

    var resource = getServletURL() + "/users/" + id + queryString;
    var user = JSON.parse(read(resource));
    document.getElementById("user-table").innerHTML = getTable([user]);
}

function populateGroupList() {
    var list = document.getElementById("select-group");

    // Sort groups by name, which is a string
    var options = queryObjects("/groups", [])
            .sort(function(a,b){ return a.name.toString()
                    .localeCompare(b.name.toString()) });

    if (options.length > 0) { empty(list); }

    for (var i = 0; i < options.length; i++) {
        var element = document.createElement("option");
        element.textContent = options[i].name;
        element.value = options[i].name;
        list.appendChild(element);
    }
}

function readGroup(form) {
    var list = document.getElementById("select-group");
    var id = list.options[list.selectedIndex].value;

    var queryString = "?_fields=name,members,description";
    var resource = getServletURL() + "/groups/" + id + queryString;
    var group = JSON.parse(read(resource));

    var names = "";
    if (group.members.length > 0) {
        names = getUserName(group.members[0]);
        for (var i = 1; i < group.members.length; i++) {
            names = names + "<br />" + getUserName(group.members[i]);
        }
    }
    group.members = names;
    document.getElementById("group-table").innerHTML = getTable([group]);
}
    </script>
</head>
<body>
<h1>Read</h1>

<form id="read-user">
    <h2>Read User</h2>
    <label for="select-user">User to read: </label>
    <select id="select-user" onfocus="populateUserList()">
        <option>Select User</option>
    </select>
    <button type="button" onclick="readUser(this.form)">Read</button>
    <br />

    Properties:
    <input id="mail" type="checkbox" checked="checked" />
    <label for="mail">Email</label>

    <input id="fullname" type="checkbox" checked="checked" />
    <label for="fullname">Full name</label>

    <input id="phone" type="checkbox" />
    <label for="phone">Phone number</label>

    <input id="all" type="checkbox" />
    <label for="all">Everything</label>
</form>
<div id="user-table"></div>

<form id="read-group">
    <h2>Read Group</h2>
    <label for="select-group">Group to read: </label>
    <select id="select-group" onfocus="populateGroupList()">
        <option>Select Group</option>
    </select>

    <button type="button" onclick="readGroup(this.form)">Read</button>
</form>
<div id="group-table"></div>
</body>
</html>